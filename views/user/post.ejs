		<%- include("partials/header"); -%>


  <!-- Page Content -->
  <div class="container">

    <!-- Page Heading/Breadcrumbs -->
    <h1 class="mt-4 mb-3">
      <%= post.title  %> 
    </h1>

    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="index.html">Home</a>
      </li>
      <li class="breadcrumb-item active">Blog Home 2</li>
    </ol>

    <div class="row">

      <!-- Post Content Column -->
      <div class="col-lg-8">

        <!-- Preview Image -->
       <% if(post.image){ %>
       <img class="img-fluid rounded" src="<%= post.image %>" alt="">

       <% } else { %>
       <img class="img-fluid rounded" src="http://placehold.it/750x300" alt="">

       <% } %>

        <hr>

        <!-- Date/Time -->
        <p>Posted on January 1, 2017 at 12:00 PM</p>

        <hr>

        <!-- Post Content -->
        <p class="lead"> <%= post.content  %> </p>

       
        <!-- Comments Form -->
        <div class="card my-4">
          <h5 class="card-header">Leave a Comment:</h5>
          <div class="card-body">
            <form method="POST" onsubmit="return doComment(this);" action="/do-comment">
              <input type="hidden" id="post_id" name="post_id" value="<%= post._id  %>">
              <div class="form-group">
                <input type="text" name="username" class="form-control" placeholder="username">
              </div>
              <div class="form-group">
                <textarea name="comment" class="form-control" rows="3" placeholder="Comment"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">Submit</button>
            </form>
          </div>
        </div>
        <script>
          var socket = io();
          function doComment(form) {
            var formData = {
            username: form.username.value,
            comment: form.comment.value,
            post_id: form.post_id.value
            }
            $.ajax({
              url: "/do-comment",
              method: "POST",
              data: formData,
              success: function (response) {
                formData._id = response._id;
                socket.emit("new_comment", formData);
                alert(response.text);
              }
            });
            return false;
          }
          socket.on("new_comment", function(comment){
            if(comment.post_id != $("#post_id").val()){
              return false;
            }
             var html = "";
            html += '<div class="media mb-4">';
              html += '<img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">';
              html += '<div class="media-body">';
                html += '<h5 class="mt-0">';
                   html += comment.username;
                  html += '</h5>';
                html += comment.comment;
              html += '</div>';
              html += '</div>';
               $("#comments").prepend(html);

          });
          
        </script>

        <!-- Single Comment -->
        <div id="comments">
        <% if(post.comments){ %>
        <% post.comments = post.comments.reverse();%>
        <% post.comments.forEach(function(comment){ %> 
        <div class="media mb-4">
          <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
          <div class="media-body">
            <h5 class="mt-0"> <%= comment.username  %></h5>
            <%= comment.comment  %>
          </div>
        </div>
        <%  })%>
        <%  }%>
        

      </div>
      </div>
      
    </div>
   

  </div>
  <!-- /.container -->

 	<%- include("partials/footer"); -%>